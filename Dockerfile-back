# ---------- Stage 1: Build ----------
FROM maven:3.9.6-eclipse-temurin-17 AS build
WORKDIR /app

# Copy only what is needed for build (fast + small)
COPY . .

# Build with system mvn (non-interactive)
RUN mvn -B clean package -DskipTests

# ---------- Stage 2: Runtime ----------
FROM openjdk:17-jdk-slim
WORKDIR /app

# Copy the built jar from the build stage
COPY --from=build /app/target/*.jar app.jar

EXPOSE 8083

ENV SPRING_DATASOURCE_URL=jdbc:postgresql://host.docker.internal:5432/sanisidro
ENV SPRING_DATASOURCE_USERNAME=sanisidro
ENV SPRING_DATASOURCE_PASSWORD=sanisidro
ENV TZ=Asia/Kolkata

ENTRYPOINT ["java", "-Duser.timezone=Asia/Kolkata", "-jar", "app.jar"]
